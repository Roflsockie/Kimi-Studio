<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AO3 Smart Formatter</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* { box-sizing: border-box; }

body {
    margin: 0;
    padding: 20px;
    background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
    color: #eaeaea;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
}

.container {
    max-width: 900px;
    margin: auto;
}

header {
    text-align: center;
    margin-bottom: 20px;
    padding: 16px;
    background: rgba(255,255,255,0.05);
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.1);
}

h1 {
    margin: 0;
    color: #00e5ff;
}

.card {
    background: rgba(0,0,0,0.4);
    border-radius: 14px;
    padding: 16px;
    border: 1px solid rgba(255,255,255,0.1);
}

.file-btn {
    display: block;
    padding: 14px;
    margin-bottom: 12px;
    text-align: center;
    border: 2px dashed #00e5ff;
    border-radius: 10px;
    color: #00e5ff;
    cursor: pointer;
    font-weight: 600;
}

.file-btn input {
    display: none;
}

textarea {
    width: 100%;
    min-height: 260px;
    background: #0b0f14;
    color: #7CFFB2;
    border: 1px solid #333;
    border-radius: 10px;
    padding: 14px;
    font-family: "Courier New", monospace;
    font-size: 14px;
    margin-bottom: 14px;
}

.buttons {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 10px;
    margin-bottom: 14px;
}

button {
    padding: 12px;
    border-radius: 10px;
    border: none;
    font-weight: 600;
    cursor: pointer;
}

.format { background: #00e5ff; color: #000; }
.copy { background: #43e97b; color: #000; }
.download { background: #667eea; color: #fff; }
.clear { background: #f5576c; color: #fff; }

#output {
    background: #0b0f14;
    border-radius: 10px;
    padding: 14px;
    font-family: "Courier New", monospace;
    font-size: 13px;
    color: #ccc;
    white-space: pre-wrap;
    max-height: 320px;
    overflow-y: auto;
}
</style>
</head>

<body>
<div class="container">
<header>
    <h1>‚ú® AO3 Smart Formatter</h1>
    <p>Mobile-friendly HTML formatter for Archive of Our Own</p>
</header>

<div class="card">

<label class="file-btn">
üìÅ Upload TXT or HTML
<input type="file" id="fileInput" accept=".txt,.html">
</label>

<textarea id="input" placeholder="Paste your text here..."></textarea>

<div class="buttons">
    <button class="format" onclick="formatText()">‚ú® Format</button>
    <button class="copy" onclick="copyHTML()">üìã Copy HTML</button>
    <button class="download" onclick="downloadHTML()">‚¨áÔ∏è Download HTML</button>
    <button class="download" onclick="downloadTXT()">üíæ Download TXT</button>
    <button class="clear" onclick="clearAll()">üóëÔ∏è Clear</button>
</div>

<div id="output">Formatted HTML will appear here‚Ä¶</div>

</div>
</div>

<script>
const input = document.getElementById('input');
const output = document.getElementById('output');

document.getElementById('fileInput').addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = ev => {
        input.value = ev.target.result;
    };
    reader.readAsText(file);
});

function smartQuotes(text) {
    return text.replace(/"([^"]+)"/g, '¬´$1¬ª');
}

function formatText() {
    const text = input.value;
    if (!text.trim()) return;

    const lines = text.split('\n');
    let result = '';

    lines.forEach(line => {
        let t = line.trim();
        if (!t) return;

        t = smartQuotes(t);
        result += `<p>${t}</p>\n`;
    });

    output.textContent = result;
}

function copyHTML() {
    if (!output.textContent.trim()) return;
    navigator.clipboard.writeText(output.textContent);
    alert('HTML copied to clipboard');
}

function downloadHTML() {
    if (!output.textContent.trim()) return;
    const blob = new Blob([output.textContent], { type: 'text/html; charset=utf-8' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'ao3_ready.html';
    a.click();
}

function downloadTXT() {
    if (!output.textContent.trim()) return;
    const text = output.textContent.replace(/<[^>]+>/g, '');
    const blob = new Blob([text], { type: 'text/plain; charset=utf-8' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'ao3_ready.txt';
    a.click();
}

function clearAll() {
    input.value = '';
    output.textContent = '';
}
</script>

</body>
</html>